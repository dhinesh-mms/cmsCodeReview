function switchLists(e){$($(e.currentTarget).parent().sortable("option","connectWith")).not($(e.currentTarget).parent()).append(e.currentTarget)}function GroupSecurityCallBack(e){$("#groupsIn, #groupsOut").sortable({connectWith:".connectedSortable",dropOnEmpty:!0}).disableSelection(),$(".li-sortable",e).dblclick(switchLists)}function GroupSecuritySubmit(){var e=$("#groupsIn").attr("href")+"&ajax=true";serializedData=$("#groupsIn").sortable("serialize"),$.ajax({type:"post",url:e,cache:!1,dataType:"json",data:serializedData,success:XiboSubmitResponse})}function DisplayGroupManageMembersCallBack(e){$("#displaysIn, #displaysOut").sortable({connectWith:".connectedSortable",dropOnEmpty:!0}).disableSelection(),$(".li-sortable",e).dblclick(switchLists)}function DisplayGroupMembersSubmit(){var e=$("#displaysIn").attr("href")+"&ajax=true";serializedData=$("#displaysIn").sortable("serialize"),$.ajax({type:"post",url:e,cache:!1,dataType:"json",data:serializedData,success:XiboSubmitResponse})}var FileAssociationsCallback=function(){$("#FileAssociationsTable .library_assign_list_select").click((function(){var e=$(this).parent().parent(),a=$("<li/>",{text:e.attr("litext"),id:e.attr("rowid"),class:"li-sortable",dblclick:function(){$(this).remove()}});a.appendTo("#FileAssociationsSortable"),$("<span/>",{class:"fa fa-minus",click:function(){$(this).parent().remove(),$(".modal-body .XiboGrid").each((function(){var e=$(this).attr("id");XiboGridRender(e)}))}}).appendTo(a),e.remove()})),$("#FileAssociationsSortable li .fa-minus").click((function(){$(this).parent().remove()})),$("#FileAssociationsSortable").sortable().disableSelection()},FileAssociationsSubmit=function(e){var a=$("#FileAssociationsSortable").sortable("serialize");$.ajax({type:"post",url:"index.php?p=displaygroup&q=SetFileAssociations&displaygroupid="+e+"&ajax=true",cache:!1,dataType:"json",data:a,success:XiboSubmitResponse})},settingsUpdated=function(e){e.success||SystemMessage(""==e.message?translation.failure:e.message,!0)};function permissionsFormOpen(e){var a=$("#permissionsTable").closest(".XiboGrid");a.data().permissions.length<=0&&(a.data().permissions={});var t=$("#permissionsTable").DataTable({language:dataTablesLanguage,serverSide:!0,stateSave:!0,filter:!1,searchDelay:3e3,order:[[0,"asc"]],ajax:{url:a.data().url,data:function(e){$.extend(e,a.find(".permissionsTableFilter form").serializeObject())}},columns:[{data:"group",render:function(e,a,t,s){return"display"!=a||1==t.isUser?e:"<strong>"+e+"</strong>"}},{data:"view",render:function(e,t,s,i){if("display"!=t)return e;var n;if(s.groupId in a.data().permissions){var r=a.data().permissions[s.groupId];n=void 0!==r.view&&1===r.view?1:0}else n=e;return'<input type="checkbox" data-permission="view" data-group-id="'+s.groupId+'" '+(1===n?"checked":"")+" />"}},{data:"edit",render:function(e,t,s,i){if("display"!=t)return e;var n;if(s.groupId in a.data().permissions){var r=a.data().permissions[s.groupId];n=void 0!==r.edit&&1===r.edit?1:0}else n=e;return'<input type="checkbox" data-permission="edit" data-group-id="'+s.groupId+'" '+(1===n?"checked":"")+" />"}},{data:"delete",render:function(e,t,s,i){if("display"!=t)return e;var n;if(s.groupId in a.data().permissions){var r=a.data().permissions[s.groupId];n=void 0!==r.delete&&1===r.delete?1:0}else n=e;return'<input type="checkbox" data-permission="delete" data-group-id="'+s.groupId+'" '+(1===n?"checked":"")+" />"}}]});t.on("draw",(function(e,t){dataTableDraw(e,t),$("#"+e.target.id).find("input[type=checkbox]").change((function(){var e=$(this).data().groupId,t=$(this).data().permission,s=$(this).is(":checked");void 0===a.data().permissions[e]&&(a.data().permissions[e]={}),a.data().permissions[e][t]=s?1:0}))})),t.on("processing.dt",dataTableProcessing),a.find(".permissionsTableFilter form input, .permissionsTableFilter form select").change((function(){t.ajax.reload()}))}function permissionsFormSubmit(e){var a=$("#"+e),t=a.closest(".permissions-form"),s={groupIds:$(a).data().permissions,ownerId:t.find("select[name=ownerId]").val()},i=$.param(s);$.ajax({type:"POST",url:a.data().url,cache:!1,dataType:"json",data:i,success:function(e,t,s){XiboSubmitResponse(e,a)},error:function(e,a,t){SystemMessage(e.responseText,!1)}})}function permissionsMultiFormOpen(e){var a=$(e).find("#permissionsMultiTable"),t=a.closest(".XiboGrid"),s=a.DataTable({language:dataTablesLanguage,serverSide:!0,stateSave:!0,filter:!1,searchDelay:3e3,order:[[0,"asc"]],ajax:{url:t.data().url,data:function(e){$.extend(e,t.find(".permissionsMultiTableFilter form").serializeObject()),$.extend(e,{ids:t.data().targetIds})},dataSrc:function(e){var a=e.data;for(var s in a)if(a.hasOwnProperty(s)){var i={view:null,edit:null,delete:null};for(var n in a[s].permissions)if(a[s].permissions.hasOwnProperty(n)){var r=a[s].permissions[n];r.view!=i.view&&(null!=i.view?i.view=2:i.view=r.view),r.edit!=i.edit&&(null!=i.edit?i.edit=2:i.edit=r.edit),r.delete!=i.delete&&(null!=i.delete?i.delete=2:i.delete=r.delete)}a[s]=Object.assign(i,a[s]),delete a[s].permissions}return t.data().permissions=Object.assign({},t.data().permissions,a),t.data().startPermissions=Object.assign({},t.data().startPermissions,JSON.parse(JSON.stringify(a))),null==t.data().savePermissions&&(t.data().savePermissions={}),Object.values(a)}},columns:[{data:"group",render:function(e,a,t,s){return"display"!=a||1==t.isUser?e:"<strong>"+e+"</strong>"}},{data:"view",render:function(e,a,s,i){if("display"!=a)return e;var n;if(s.groupId in t.data().permissions){var r=t.data().permissions[s.groupId];n=void 0!==r.view&&0!==r.view?r.view:0}else n=e;return'<input type="checkbox" class="'+(2===n?"indeterminate":"")+'" data-permission="view" data-group-id="'+s.groupId+'" '+(1===n?"checked":"")+" />"}},{data:"edit",render:function(e,a,s,i){if("display"!=a)return e;var n;if(s.groupId in t.data().permissions){var r=t.data().permissions[s.groupId];n=void 0!==r.edit&&0!==r.edit?r.edit:0}else n=e;return'<input type="checkbox" class="'+(2===n?"indeterminate":"")+'" data-permission="edit" data-group-id="'+s.groupId+'" '+(1===n?"checked":"")+" />"}},{data:"delete",render:function(e,a,s,i){if("display"!=a)return e;var n;if(s.groupId in t.data().permissions){var r=t.data().permissions[s.groupId];n=void 0!==r.delete&&0!==r.delete?r.delete:0}else n=e;return'<input type="checkbox" class="'+(2===n?"indeterminate":"")+'" data-permission="delete" data-group-id="'+s.groupId+'" '+(1===n?"checked":"")+" />"}}]});s.on("draw",(function(a,s){dataTableDraw(a,s);var i=$("#"+a.target.id);i.find("input[type=checkbox]").change((function(){var a=$(this).data().groupId,s=$(this).data().permission,i=$(this).is(":checked")?1:0;void 0===t.data().permissions[a]&&(t.data().permissions[a]={}),t.data().permissions[a][s]=i,void 0===t.data().savePermissions[a]?(t.data().savePermissions[a]={},t.data().savePermissions[a][s]=i):t.data().startPermissions[a][s]===i?(delete t.data().savePermissions[a][s],$.isEmptyObject(t.data().savePermissions[a])&&delete t.data().savePermissions[a]):t.data().savePermissions[a][s]=i,$(e).find(".save-button").toggleClass("disabled",$.isEmptyObject(t.data().savePermissions))})),i.find("input[type=checkbox].indeterminate").prop("indeterminate",!0).prop("title",translations.indeterminate)})),$(e).find(".save-button").addClass("disabled"),s.on("processing.dt",dataTableProcessing),t.find(".permissionsMultiTableFilter form input, .permissionsMultiTableFilter form select").change((function(){s.ajax.reload()}))}function permissionsMultiFormSubmit(e){var a=$("#"+e),t=$(a).data().savePermissions,s=$(a).data().targetIds,i=$.param({groupIds:t,ids:s});$.ajax({type:"POST",url:a.data().url,cache:!1,dataType:"json",data:i,success:function(e,t,s){XiboSubmitResponse(e,a)},error:function(e,a,t){SystemMessage(e.responseText,!1)}})}function createDisplayGroupMembersTable(e){const a=$(e).find(".controlDiv"),t={tableName:"#displaysGroupsMembersTable",columns:[{data:"displayGroupId",responsivePriority:2},{data:"displayGroup",responsivePriority:2}],members:a.data().members.displayGroups,extra:e.data().extra.displayGroupsAssigned,id:"displayGroupId",type:"displayGroup",getUrl:a.data().displayGroupsGetUrl};createTableFromContext(e,t)}function createDisplayMembersTable(e){const a=$(e).find(".controlDiv"),t={tableName:"#displaysMembersTable",columns:[{data:"displayId",responsivePriority:2},{data:"display",responsivePriority:2},{data:"mediaInventoryStatus",responsivePriority:2,render:function(e,a,t){if("display"!=a)return e;let s="";return s=1==e?"fa-check":0==e?"fa-times":"fa-cloud-download","<span class='fa "+s+"'></span>"}},{data:"loggedIn",render:dataTableTickCrossColumn,responsivePriority:3},{name:"clientSort",responsivePriority:3,data:function(e){return e.clientType+" "+e.clientVersion+"-"+e.clientCode},visible:!1}],members:a.data().members.displays,extra:e.data().extra.displaysAssigned,id:"displayId",type:"display",getUrl:a.data().displayGetUrl};createTableFromContext(e,t)}function createUserMembersTable(e){const a=$(e).find(".controlDiv"),t={tableName:"#userMembersTable",columns:[{data:"userId",responsivePriority:2},{data:"userName",responsivePriority:2}],members:a.data().members.users,extra:e.data().extra.usersAssigned,id:"userId",type:"user",getUrl:a.data().userGetUrl};createTableFromContext(e,t)}function createUserGroupMembersTable(e){const a=$(e).find(".controlDiv"),t={tableName:"#userGroupMembersTable",columns:[{data:"groupId",responsivePriority:2},{data:"group",responsivePriority:2}],members:a.data().members.userGroups,extra:e.data().extra.userGroupsAssigned,id:"groupId",type:"userGroup",getUrl:a.data().userGroupsGetUrl};createTableFromContext(e,t)}function createTableFromContext(e,a){const t=$(e).find(".controlDiv"),s=a.columns;s.push({name:"member",responsivePriority:2,data:function(s,i,n){if("display"!=i)return s;let r="";return void 0!==t.data().members&&null!=a.members[s[a.id]]?r=a.members[s[a.id]]?"checked":"":e.data().extra&&a.extra.forEach((function(e){e[a.id]==s[a.id]&&(r="checked")})),'<input type="checkbox" class="checkbox" data-member-id='+s[a.id]+' data-member-type="'+a.type+'" '+r+">"}});const i=$(a.tableName).DataTable({language:dataTablesLanguage,serverSide:!0,stateSave:!0,stateDuration:0,filter:!1,responsive:!0,searchDelay:3e3,order:[[1,"asc"]],ajax:{url:a.getUrl??t.data().getUrl,data:function(e){return $.extend(e,$(a.tableName).closest(".XiboGrid").find(".FilterDiv form").serializeObject()),e}},columns:s});i.on("draw",dataTableDraw),i.on("processing.dt",dataTableProcessing)}function membersFormOpen(e){const a=$(e).find(".controlDiv");null==a.data().members&&(a.data().members={displays:{},displayGroups:{},users:{},userGroups:{}}),a.data().displayGroups&&createDisplayGroupMembersTable(e),a.data().display&&createDisplayMembersTable(e),a.data().userGroups&&createUserGroupMembersTable(e),a.data().user&&createUserMembersTable(e),a.on("change",".checkbox",(function(){const e=$(this).data().memberId,t=$(this).data().memberType,s=$(this).is(":checked");"display"===t?a.data().members.displays[e]=s?1:0:"displayGroup"===t?a.data().members.displayGroups[e]=s?1:0:"user"===t?a.data().members.users[e]=s?1:0:"userGroup"===t&&(a.data().members.userGroups[e]=s?1:0)}))}function membersFormSubmit(e){const a=$("#"+e),t=a.data().members;if(null==t)return void XiboDialogClose();window.queue=$.jqmq({delay:-1,batch:1,callback:function(e){$.ajax({type:"POST",url:e.url,cache:!1,dataType:"json",data:$.param(e.data),success:function(e,t,s){e.success?(""!=e.message&&SystemMessage(e.message,!0),queue.next()):e.login?LoginBox(e.message):(a.closest(".modal-dialog").find(".saving").remove(),SystemMessageInline(e.message,a.closest(".modal")))},error:function(e){a.closest(".modal-dialog").find(".saving").remove(),SystemMessage(e,!1)}})},complete:function(){a.closest(".modal-dialog").find(".saving").parent().remove(),XiboRefreshAllGrids(),void 0!==a.data("nextFormUrl")&&XiboFormRender(a.data().nextFormUrl),XiboDialogClose()}});let s=!1;const i=[],n=[];if($.each(t.displays,(function(e,a){1==a?i.push(e):n.push(e)})),i.length>0||n.length>0){const e={data:{},url:a.data().displayUrl};e.data[a.data().displayParam]=i,e.data[a.data().displayParamUnassign]=n,queue.add(e),s=!0}const r=[],o=[];if($.each(t.displayGroups,(function(e,a){1==a?r.push(e):o.push(e)})),r.length>0||o.length>0){const e={data:{},url:a.data().displayGroupsUrl};e.data[a.data().displayGroupsParam]=r,e.data[a.data().displayGroupsParamUnassign]=o,queue.add(e),s=!0}const d=[],l=[];if($.each(t.users,(function(e,a){1==a?d.push(e):l.push(e)})),d.length>0||l.length>0){const e={data:{},url:a.data().userUrl};e.data[a.data().userParam]=d,e.data[a.data().userParamUnassign]=l,queue.add(e),s=!0}const u=[],c=[];if($.each(t.userGroups,(function(e,a){1==a?u.push(e):c.push(e)})),u.length>0||c.length>0){const e={data:{},url:a.data().userGroupsUrl};e.data[a.data().userGroupsParam]=u,e.data[a.data().userGroupsParamUnassign]=c,queue.add(e),s=!0}s?queue.start():XiboDialogClose()}function mediaDisplayGroupFormCallBack(){var e=$("#FileAssociationsAssign");null==e.data().media&&(e.data().media={});var a=[];$("#FileAssociationsSortable").find("[data-media-id]").each(((e,t)=>{a.push($(t).data("mediaId"))}));var t=$("#mediaAssignments").DataTable({language:dataTablesLanguage,serverSide:!0,stateSave:!0,searchDelay:3e3,order:[[0,"asc"]],filter:!1,ajax:{url:$("#mediaAssignments").data().url,data:function(e){$.extend(e,$("#mediaAssignments").closest(".XiboGrid").find(".FilterDiv form").serializeObject())}},columns:[{data:"name"},{data:"mediaType"},{sortable:!1,data:function(e,t,s,i){return"display"!=t?"":-1!=a.indexOf(e.mediaId)?'<a href="#" class="assignItem disabled"><span class="fa fa-plus hidden"></a>':'<a href="#" class="assignItem"><span class="fa fa-plus"></a>'}}]});t.on("draw",(function(s,i){dataTableDraw(s,i),$(".assignItem:not(.disabled)","#mediaAssignments").on("click",(function(){var s=t.row($(this).closest("tr")).data();e.data().media[s.mediaId]=1,a.push(s.mediaId),$(this).parents("tr").addClass("disabled"),$(this).hide();var i=$("<li/>",{text:s.name,"data-media-id":s.mediaId,class:"btn btn-sm btn-white"});i.appendTo("#FileAssociationsSortable"),$("<span/>",{class:"fa fa-minus ml-1"}).appendTo(i)}))})),t.on("processing.dt",dataTableProcessing),$("#FileAssociationsSortable").sortable(),$("#FileAssociationsSortable").on("click","li span",(function(){var s=$(this).parent().data().mediaId;e.data().media[s]=0,$(this).parent().remove(),a=a.filter((e=>e!=s)),t.ajax.reload()})),$("#mediaAssignments").closest(".XiboGrid").find(".FilterDiv input, .FilterDiv select").change((function(){t.ajax.reload()}))}function mediaAssignSubmit(){var e=$("#FileAssociationsAssign"),a=[],t=[];$.each(e.data().media,(function(e,s){1==s?a.push(e):t.push(e)})),assignMediaToCampaign(e.data().url,a,t)}var assignMediaToCampaign=function(e,a,t){toastr.info("Assign Media",a),$.ajax({type:"post",url:e,cache:!1,dataType:"json",data:{mediaId:a,unassignMediaId:t},success:XiboSubmitResponse})};function layoutFormCallBack(){var e=$("#FileAssociationsAssign");null==e.data().layout&&(e.data().layout={});var a=$("#layoutAssignments").DataTable({language:dataTablesLanguage,serverSide:!0,stateSave:!0,searchDelay:3e3,order:[[0,"asc"]],filter:!1,ajax:{url:$("#layoutAssignments").data().url,data:function(e){$.extend(e,$("#layoutAssignments").closest(".XiboGrid").find(".FilterDiv form").serializeObject())}},columns:[{data:"layout"},{sortable:!1,data:function(e,a,t,s){return"display"!=a?"":'<a href="#" class="assignItem"><span class="fa fa-plus"></a>'}}]});a.on("draw",(function(t,s){dataTableDraw(t,s),$(".assignItem","#layoutAssignments").click((function(){var t=a.row($(this).closest("tr")).data();e.data().layout[t.layoutId]=1;var s=$("<li/>",{text:t.layout,"data-layout-id":t.layoutId,class:"btn btn-sm btn-white"});s.appendTo("#FileAssociationsSortable"),$("<span/>",{class:"fa fa-minus",click:function(){e.data().layout[$(this).parent().data().layoutId]=0,$(this).parent().remove()}}).appendTo(s)}))})),a.on("processing.dt",dataTableProcessing),$("#FileAssociationsSortable").sortable(),$("#FileAssociationsSortable").find("li span").click((function(){e.data().layout[$(this).parent().data().layoutId]=0,$(this).parent().remove()})),$("#layoutAssignments").closest(".XiboGrid").find(".FilterDiv input, .FilterDiv select").change((function(){a.ajax.reload()}))}function layoutAssignSubmit(){var e=$("#FileAssociationsAssign"),a=[],t=[];$.each(e.data().layout,(function(e,s){1==s?a.push(e):t.push(e)})),assignLayoutToCampaign(e.data().url,a,t)}var assignLayoutToCampaign=function(e,a,t){toastr.info("Assign Layout",a),$.ajax({type:"post",url:e,cache:!1,dataType:"json",data:{layoutId:a,unassignLayoutId:t},success:XiboSubmitResponse})};function regionEditFormSubmit(){XiboFormSubmit($("#regionEditForm"),null,(function(e,a){e.success&&window.location.reload()}))}function userProfileEditFormOpen(){$("#qRCode").addClass("d-none"),$("#recoveryButtons").addClass("d-none"),$("#recoveryCodes").addClass("d-none"),$("#twoFactorTypeId").on("change",(function(e){e.preventDefault(),2==$("#twoFactorTypeId").val()&&2!=$("#userEditProfileForm").data().currentuser?($.ajax({url:$("#userEditProfileForm").data().setup,type:"GET",beforeSend:function(){$("#qr").addClass("fa fa-spinner fa-spin loading-icon")},success:function(e){let a=e.data.qRUrl;$("#qrImage").attr("src",a)},complete:function(){$("#qr").removeClass("fa fa-spinner fa-spin loading-icon")}}),$("#qRCode").removeClass("d-none")):$("#qRCode").addClass("d-none"),0==$("#twoFactorTypeId").val()&&($("#recoveryButtons").addClass("d-none"),$("#recoveryCodes").addClass("d-none")),0!=$("#userEditProfileForm").data().currentuser&&0!=$("#twoFactorTypeId").val()&&$("#recoveryButtons").removeClass("d-none")})),0!=$("#userEditProfileForm").data().currentuser&&$("#recoveryButtons").removeClass("d-none");let e="";$("#generateCodesBtn").on("click",(function(a){$("#codesList").html(""),$("#recoveryCodes").removeClass("d-none"),$(".recBtn").attr("disabled",!0).addClass("disabled"),e="",$.ajax({url:$("#userEditProfileForm").data().generate,async:!1,type:"GET",beforeSend:function(){$("#codesList").removeClass("card").addClass("fa fa-spinner fa-spin loading-icon")},success:function(a){e=JSON.parse(a.data.codes),$("#recoveryCodes").addClass("d-none"),$(".recBtn").attr("disabled",!1).removeClass("disabled"),$("#showCodesBtn").click()},complete:function(){$("#codesList").removeClass("fa fa-spinner fa-spin loading-icon")}})})),$("#showCodesBtn").on("click",(function(a){$(".recBtn").attr("disabled",!0).addClass("disabled"),$("#codesList").html(""),$("#recoveryCodes").toggleClass("d-none");let t=[];$.ajax({url:$("#userEditProfileForm").data().show,type:"GET",data:{generatedCodes:e},success:function(a){t=""!=e?e:a.data.codes,$("#twoFactorRecoveryCodes").val(JSON.stringify(t)),$.each(t,(function(e,a){$("#codesList").append(a+"<br/>")})),$("#codesList").addClass("card"),$(".recBtn").attr("disabled",!1).removeClass("disabled")}})}))}function tagsWithValues(e){let a;$('#tagValue, label[for="tagValue"], #tagValueRequired').addClass("d-none"),$("#tagValueContainer").hide();let t="",s="",i="",n=[],r=0,o="#"+e+" input#tags, #"+e+" input#tagsToAdd";$(o).on("beforeItemAdd",(function(t){if($("#tagValue").html(""),$("#tagValueInput").val(""),a=t.item,n=[],r=0,s=a.split("|")[0],i=a.split("|")[1],$(o).val().indexOf(s)>=0){let e=$(o).tagsinput("items").filter((e=>e.split("|")[0].toLowerCase()===s.toLowerCase()));$(o).tagsinput("remove",e.toString())}-1===$(o).val().indexOf(s)&&void 0===i&&$.ajax({url:$("form#"+e).data().gettag,type:"GET",data:{name:s},beforeSend:function(){$("#loadingValues").addClass("fa fa-spinner fa-spin loading-icon")},success:function(e){e.success&&(null!=e.data.tag?(n=JSON.parse(e.data.tag.options),r=e.data.tag.isRequired,null!=n&&n!=[]?($('#tagValue, label[for="tagValue"]').removeClass("d-none"),$('#tagValue option[value=""]').length<=0&&$("#tagValue").append($("<option></option>").attr("value","").text("")),$.each(n,(function(e,a){$("#tagValue option[value="+a+"]").length<=0&&$("#tagValue").append($("<option></option>").attr("value",a).text(a))})),$("#tagValue").focus()):($("#tagValueContainer").show(),0===r?$("#tagValueInput").parent().find("span.help-block").text(translations.tagInputValueHelpText):$("#tagValueInput").parent().find("span.help-block").text(translations.tagInputValueRequiredHelpText),$("#tagValueInput").focus())):($("#tagValueContainer").show(),$("#tagValueInput").focus(),$("#tagValueInput").parent().find("span.help-block").text(translations.tagInputValueHelpText)))},complete:function(){$("#loadingValues").removeClass("fa fa-spinner fa-spin loading-icon")},error:function(e,a,t){console.error(e,a,t)}})})),$(o).on("itemAdded",(function(e){null!=n&&n!==[]&&$("#tagValue").focus()})),$(o).on("itemRemoved",(function(e){s===e.item?($('#tagValueRequired, label[for="tagValue"]').addClass("d-none"),$(".save-button").prop("disabled",!1),$("#tagValue").html("").addClass("d-none"),$("#tagValueInput").val(""),$("#tagValueContainer").hide(),s=""):$(".save-button").is(":disabled")||($("#tagValue").html("").addClass("d-none"),$("#tagValueInput").val(""),$("#tagValueContainer").hide(),$('label[for="tagValue"]').addClass("d-none"))})),$("#tagValue").on("change",(function(e){e.preventDefault(),t=s+"|"+$(this).val(),""!=s&&(0===r||1===r&&""!==$(this).val()?($(o).tagsinput("add",t),$(o).tagsinput("remove",s),$("#tagValue").html("").addClass("d-none"),$('#tagValueRequired, label[for="tagValue"]').addClass("d-none"),$(".save-button").prop("disabled",!1)):($("#tagValueRequired").removeClass("d-none"),$("#tagValue").focus()))})),$("#tagValue").blur((function(){""===$(this).val()&&1===r?($("#tagValueRequired").removeClass("d-none"),$("#tagValue").focus(),$(".save-button").prop("disabled",!0)):($("#tagValue").html("").addClass("d-none"),$('label[for="tagValue"]').addClass("d-none"))})),$("#tagValueInput").on("keypress focusout",(function(e){if((13===e.keyCode||"focusout"===e.type)&&""!=s){e.preventDefault();let a=$(this).val();t=""!==a?s+"|"+a:s,0===r||1===r&&""!==a?($(o).tagsinput("add",t),""!==a&&$(o).tagsinput("remove",s),$("#tagValueInput").val(""),$("#tagValueContainer").hide(),$("#tagValueRequired").addClass("d-none"),$(".save-button").prop("disabled",!1)):($("#tagValueContainer").show(),$("#tagValueRequired").removeClass("d-none"),$("#tagValueInput").focus())}}))}function featureAclFormOpen(e){$(e).find("tr.feature-row").hide(),$(e).find("td.feature-group-header-cell").on("click",(function(){var e=$(this);e.hasClass("open")?(e.find(".feature-group-description").show(),e.find("i.fa").removeClass("fa-arrow-circle-up").addClass("fa fa-arrow-circle-down"),e.closest("tbody.feature-group").find("tr.feature-row").hide(),e.removeClass("open").addClass("closed")):(e.find(".feature-group-description").hide(),e.find("i.fa").removeClass("fa-arrow-circle-down").addClass("fa fa-arrow-circle-up"),e.closest("tbody.feature-group").find("tr.feature-row").show(),e.removeClass("closed").addClass("open"))})).each((function(e,a){setFeatureGroupCheckboxState($(this))})),$(e).find("input[name='features[]']").on("click",(function(){setFeatureGroupCheckboxState($(this))})),$(e).find("input.feature-select-all").on("click",(function(){$(this).closest("tbody.feature-group").find("input[name='features[]']").prop("checked",$(this).is(":checked"))}))}function setFeatureGroupCheckboxState(e){var a=e.closest("tbody.feature-group");setCheckboxState(a.find("input[name='features[]']:checked").length,a.find("input[name='features[]']").length,a,".feature-select-all"),setCheckboxState(a.find("input.inherit-group:checked").length,a.find("input.inherit-group").length,a,".inherit-group-all")}function setCheckboxState(e,a,t,s){e<=0?t.find(s).prop("checked",!1).prop("indeterminate",!1):e===a?t.find(s).prop("checked",!0).prop("indeterminate",!1):t.find(s).prop("checked",!1).prop("indeterminate",!0)}function userApprovedApplicationsFormOpen(e){$(".revokeAccess").on("click",(function(e){var a=$(this),t=a.data("applicationKey"),s=a.data("applicationUser");$.ajax({url:revokeApplicationAccess.replace(":id",t).replace(":userId",s),type:"DELETE",success:function(e){e.success?(a.closest("tr").remove(),toastr.success(e.message)):toastr.error(e.message)}})}))}function folderMoveSubmit(){XiboFormSubmit($("#moveFolderForm"),null,(function(e,a){e.success&&$("#container-folder-tree").jstree(!0).refresh()}))}