!function(){var e={73183:function(e,t,n){const a=document.querySelector('meta[name="public-path"]').content;n.p=a+"dist/"},22828:function(e,t,n){(e.exports=n(76314)(!1)).push([e.id,"/*!\n * Copyright (C) 2023 Signage Ltd\n *\n * Oasys Digital Signage - http://www.oasys.co\n *\n * This file is part of Oasys.\n *\n * signage is  software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n *  Software Foundation, either version 3 of the License, or\n * any later version.\n *\n * CMS is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with CMS.  If not, see <http://www.gnu.org/licenses/>.\n *//*!\n * Copyright (C) 2022  Signage Ltd\n *\n * Oasys Digital Signage \n *\n * This file is part of Oasys.\n *\n * signage is software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * any later version.\n *\n * cms is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with cms.  If not, see <http://www.gnu.org/licenses/>.\n */#content-wrapper .page-content>.row>div{margin:0}#content-wrapper .page-content>.row.header.header-side{height:50px;margin-bottom:0}#content-wrapper .page-content>.row.header.header-side .navbar-toggler-side{margin-top:8px;margin-right:8px}#content-wrapper .page-content>.row.header.header-side .user>.item{width:auto;height:50px;padding-right:16px}#content-wrapper .page-content>.row.header.header-side .user>.item>a{padding:7px 0}#content-wrapper .page-content>.row.header.header-side .user>.item img.nav-avatar{width:36px;height:36px;border-radius:2px}#content-wrapper .page-content>.row.header.header-side .xibo-logo-container{margin-left:50%;transform:translateX(-50%)}#content-wrapper .page-content>.row.header.header-side .xibo-logo-container .page{width:auto;padding:0}#content-wrapper .page-content>.row.header.header-side .xibo-logo-container .page .xibo-logo{height:30px;margin:10px 0}#content-wrapper .page-content>.row.header.header-side .user-notif>.item>a{padding:5px 0}#campaign-builder{margin-top:-30px}#campaign-builder .back-button{position:relative;top:-12px;left:0}#campaign-builder .back-button span{margin-left:6px;font-weight:bold}",""])},76314:function(e){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=function(e,t){var n,a=e[1]||"",i=e[3];if(!i)return a;if(t&&"function"==typeof btoa){var r=(n=i,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(n))))+" */"),o=i.sources.map((function(e){return"/*# sourceURL="+i.sourceRoot+e+" */"}));return[a].concat(o).concat([r]).join("\n")}return[a].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+n+"}":n})).join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var a={},i=0;i<this.length;i++){var r=this[i][0];null!=r&&(a[r]=!0)}for(i=0;i<e.length;i++){var o=e[i];null!=o[0]&&a[o[0]]||(n&&!o[2]?o[2]=n:n&&(o[2]="("+o[2]+") and ("+n+")"),t.push(o))}},t}},91545:function(e,t,n){var a=n(85072),i=n(22828);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.id,i,""]]);a(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},85072:function(e,t,n){"use strict";var a,i=function(){var e={};return function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}e[t]=n}return e[t]}}(),r=[];function o(e){for(var t=-1,n=0;n<r.length;n++)if(r[n].identifier===e){t=n;break}return t}function s(e,t){for(var n={},a=[],i=0;i<e.length;i++){var s=e[i],l=t.base?s[0]+t.base:s[0],c=n[l]||0,d="".concat(l," ").concat(c);n[l]=c+1;var u=o(d),p={css:s[1],media:s[2],sourceMap:s[3]};-1!==u?(r[u].references++,r[u].updater(p)):r.push({identifier:d,updater:h(p,t),references:1}),a.push(d)}return a}function l(e){var t=document.createElement("style"),a=e.attributes||{};if(void 0===a.nonce){var r=n.nc;r&&(a.nonce=r)}if(Object.keys(a).forEach((function(e){t.setAttribute(e,a[e])})),"function"==typeof e.insert)e.insert(t);else{var o=i(e.insert||"head");if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(t)}return t}var c,d=(c=[],function(e,t){return c[e]=t,c.filter(Boolean).join("\n")});function u(e,t,n,a){var i=n?"":a.media?"@media ".concat(a.media," {").concat(a.css,"}"):a.css;if(e.styleSheet)e.styleSheet.cssText=d(t,i);else{var r=document.createTextNode(i),o=e.childNodes;o[t]&&e.removeChild(o[t]),o.length?e.insertBefore(r,o[t]):e.appendChild(r)}}function p(e,t,n){var a=n.css,i=n.media,r=n.sourceMap;if(i?e.setAttribute("media",i):e.removeAttribute("media"),r&&"undefined"!=typeof btoa&&(a+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),e.styleSheet)e.styleSheet.cssText=a;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(a))}}var f=null,m=0;function h(e,t){var n,a,i;if(t.singleton){var r=m++;n=f||(f=l(t)),a=u.bind(null,n,r,!1),i=u.bind(null,n,r,!0)}else n=l(t),a=p.bind(null,n,t),i=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)};return a(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;a(e=t)}else i()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=(void 0===a&&(a=Boolean(window&&document&&document.all&&!window.atob)),a));var n=s(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var a=0;a<n.length;a++){var i=o(n[a]);r[i].references--}for(var l=s(e,t),c=0;c<n.length;c++){var d=o(n[c]);0===r[d].references&&(r[d].updater(),r.splice(d,1))}n=l}}}}},t={};function n(a){var i=t[a];if(void 0!==i)return i.exports;var r=t[a]={id:a,exports:{}};return e[a](r,r.exports,n),r.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),function(){var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var a=t.getElementsByTagName("script");if(a.length)for(var i=a.length-1;i>-1&&(!e||!/^http(s?):/.test(e));)e=a[i--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e}(),n.nc=void 0,n(73183),n(91545),window.cB={$container:null,$layoutSelect:null,templateLayoutAddForm:null,layoutAssignments:null,map:null,initialise:function(e){this.$container=e},initialiseMap:function(e,t){null!==this.map&&this.map.remove();const n=$("#"+e),a=t.find('input[name="geoFence"]');this.map=L.map(e).setView([this.getDataProperty(n,"mapLat","51"),this.getDataProperty(n,"mapLong","0.4")],this.getDataProperty(n,"mapZoom",13)),L.tileLayer(this.getDataProperty(n,"mapTileServer"),{attribution:this.getDataProperty(n,"mapAttribution",'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'),subdomains:["a","b","c"]}).addTo(this.map);const i=new L.FeatureGroup;this.map.addLayer(i);const r=new L.Control.Draw({position:"topright",draw:{polyline:!1,circle:!1,marker:!1,circlemarker:!1},edit:{featureGroup:i}});this.map.addControl(r);const o=new L.Control.Search({url:"https://nominatim.openstreetmap.org/search?format=json&q={s}",jsonpParam:"json_callback",propertyName:"display_name",propertyLoc:["lat","lon"],marker:L.circleMarker([0,0],{radius:30}),autoCollapse:!0,autoType:!1,minLength:2,hideMarkerOnCollapse:!0,firstTipSubmit:!0});this.map.addControl(o),this.map.on("draw:created",(function(e){i.addLayer(e.layer),a.val(JSON.stringify(i.toGeoJSON()))})),this.map.on("draw:edited",(function(e){a.val(JSON.stringify(i.toGeoJSON()))})),this.map.on("draw:deleted",(function(e){e.layers.eachLayer((function(e){i.removeLayer(e)})),a.val(JSON.stringify(i.toGeoJSON()))})),a.val()&&L.geoJSON(JSON.parse(a.val()),{onEachFeature:function(e,t){i.addLayer(t),cB.map.fitBounds(i.getBounds())}})},getDataProperty:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return e.data(t)||n},initaliseDisplaySelect:function(e){e.select2({ajax:{url:e.data("searchUrl"),dataType:"json",delay:250,data:function(e){const t={isDisplaySpecific:-1,forSchedule:1,displayGroup:e.term,start:0,length:10,columns:[{data:"isDisplaySpecific"},{data:"displayGroup"}],order:[{column:0,dir:"asc"},{column:1,dir:"asc"}]};return null!=e.page&&(t.start=10*(e.page-1)),t},processResults:function(t,n){const a=[],i=[];$.each(t.data,(function(e,t){1===t.isDisplaySpecific?i.push({id:t.displayGroupId,text:t.displayGroup}):a.push({id:t.displayGroupId,text:t.displayGroup})}));let r=n.page||1;return r=r>1?r-1:r,{results:[{text:e.data("transGroups"),children:a},{text:e.data("transDisplay"),children:i}],pagination:{more:10*r<t.recordsTotal}}}}})},initialiseLayoutSelect:function(e){this.$layoutSelect=e,makePagedSelect(e),e.on("select2:select",(function(e){e.params.data&&cB.openLayoutForm({layoutId:e.params.data.id,daysOfWeek:"1,2,3,4,5,6,7"},campaignBuilderTrans.addLayoutFormTitle)}))},openLayoutForm:function(e,t){null===this.templateLayoutAddForm&&(this.templateLayoutAddForm=Handlebars.compile($("#campaign-builder-layout-add-form-template").html()));const n=this.templateLayoutAddForm(e),a=bootbox.dialog({title:t,message:n,size:"large",buttons:{cancel:{label:campaignBuilderTrans.cancelButton,className:"btn-white",callback:()=>{XiboDialogClose()}},add:{label:campaignBuilderTrans.saveButton,className:"btn-primary save-button",callback:function(){return a.find(".XiboForm").submit(),!1}}}}).on("shown.bs.modal",(function(){const t=a.find(".XiboForm"),n=a.find('select[name="daysOfWeek[]"]');$.each(e.daysOfWeek.split(","),(function(e,t){n.find("option[value="+t+"]").attr("selected","selected")})),n.select2({width:"100%"}).val();const i=a.find('select[name="dayPartId"]');e.dayPartId&&i.data("initial-value",e.dayPartId),makePagedSelect(i),cB.initialiseMap("campaign-builder-map",a),a.find(".XiboForm").validate({submitHandler:function(e){XiboFormSubmit($(e),null,(()=>{const e=t.data("existingDisplayOrder");e&&parseInt(e)>0?$.ajax({method:"delete",url:t.data("assignmentRemoveUrl")+"&displayOrder="+e,complete:()=>{refreshLayoutAssignmentsTable()}}):refreshLayoutAssignmentsTable()}))},errorElement:"span",highlight:function(e){$(e).closest(".form-group").removeClass("has-success").addClass("has-error")},success:function(e){$(e).closest(".form-group").removeClass("has-error").addClass("has-success")},invalidHandler:function(e,t){$(this).closest(".modal-dialog").find(".saving").remove(),$(this).closest(".modal-dialog").find(".save-button").removeClass("disabled")}})})).on("hidden.bs.modal",(function(){cB.$layoutSelect&&cB.$layoutSelect.val(null).trigger("change")}))},initialiseLayoutAssignmentsTable:function(e){this.layoutAssignments=e.DataTable({language:dataTablesLanguage,responsive:!0,dom:dataTablesTemplate,filter:!1,searchDelay:3e3,order:[[0,"asc"]],ajax:{url:e.data("searchUrl"),dataSrc:function(e){return e&&e.data&&e.data.length>0?e.data[0].layouts:[]}},columns:[{data:"layoutId",responsivePriority:5},{data:"layout",responsivePriority:1},{data:"duration",responsivePriority:1},{data:"dayPart",responsivePriority:1},{data:"daysOfWeek",responsivePriority:3,render:function(e){if(e){const t=[];return e.split(",").forEach((e=>{t.push(campaignBuilderTrans.daysOfWeek[e]||e)})),t.join(", ")}return""}},{data:"geoFence",responsivePriority:10,render:function(e,t){return"display"!==t?!!e:'<i class="fa fa-'+(e?"check":"times")+'"></i>'}},{data:function(t,n,a,i){const r=[{id:"assignment_button_edit",text:campaignBuilderTrans.assignmentEditButton,url:"#",external:!1,class:"button-assignment-remove",dataAttributes:[{name:"row-id",value:i.row}]},{id:"assignment_button_delete",text:campaignBuilderTrans.assignmentDeleteButton,url:e.data("assignmentDeleteUrl")+"?displayOrder="+t.displayOrder}];return dataTableButtonsColumn({buttons:r},n,a,i)},orderable:!1,responsivePriority:1}]}),this.layoutAssignments.on("draw",(function(e,t){$("#"+e.target.id).find(".button-assignment-remove").on("click",(function(e){e.preventDefault();const t=$(this);return t.hasClass("assignment_button_edit")&&cB.openLayoutForm(cB.layoutAssignments.rows(t.data("rowId")).data()[0],campaignBuilderTrans.editLayoutFormTitle),!1})),XiboInitialise("#"+e.target.id)}))}},$((function(){const e=$("#campaign-builder");cB.initialise(e),cB.initaliseDisplaySelect(e.find('select[name="displayGroupIds[]"]')),cB.initialiseLayoutSelect(e.find('select[name="layoutId"]')),cB.initialiseLayoutAssignmentsTable(e.find("table#table-campaign-builder-layout-assignments"))})),window.refreshLayoutAssignmentsTable=function(){cB.layoutAssignments&&cB.layoutAssignments.ajax.reload()}}();